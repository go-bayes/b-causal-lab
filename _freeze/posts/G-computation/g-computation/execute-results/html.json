{
  "hash": "9932e43bd9ac8d6f82be6e910d5a663f",
  "result": {
    "markdown": "---\ntitle: \"G-computation\"\nauthor: \n  - name: Joseph Bulbulia\n    orcid: 0000-0002-5861-2056\n    affiliation: 1\n    corresponding: yes\n    address: Victoria University of Wellington, New Zealand\n    email: joseph.bulbulia@vuw.ac.nz\naffiliation:\n  - id: 1\n    institution: Victoria University of Wellington, New Zealand\nexecute:\n  warning: false\n  echo: false\ncitation:\n  url: https://go-bayes.github.io/b-causal-lab/\ndate: 2022-11-01\ndate-format: short\nbibliography: references.bib\n---\n\n::: {.cell}\n\n:::\n\n\n## Causal inference\n\nConsider a binary exposure $A$ with two levels, $A = 0$ and $A=1$ and a continuous outcome $Y$.  Estimating the causal effect of $A$ on outcome $Y$ requires contrasting two states of the world.  $Y$ when, perhaps contrary to fact, $A$ is set to $1$, or $Y|A=1$, which we write as ${a=1}$,$Y$ and secondly $Y$ when, perhaps contrary to fact, $A$ is set to $0$, or $Y|A =1$ which we may write as$Y^{a=0}$. We say that $A$ affects $Y$  when the quantities$Y^{a=1} - Y^{a=0} \\neq 0$.   Note that, at any given time, at most only one level of the exposure $A$ may be realised for any individual. That is, $Y^{a=1}$ and $Y^{a=0}$ are never simultaneously observed in any individual.  As such, individual-level causal effects are not typically identifiable from data. It is for this reason that we refer to the $Y^{a=1}$ and $Y^{a=0}$ as \"potential\" or \"counterfactual\" outcomes. However, when certain conditions are satisfied we may identify the average or marginal causal effects at the level of groups of individuals who are experience different levels of exposure.  We say there is an average or marginal causal effect if the difference of the averages of the population who are exposed and unexposed does not equal zero:  $E(Y^{a=1}) - E(Y^{a=0})\\neq 0$ , or because the difference of the means is equivalent to the mean of the differences, if $E(Y^{a=1} - Y^{a=0})\\neq 0$.  This contrast in tje expected average of the *counterfactual* outcomes is the marginal effect. Here, our example uses a binary exposure but we may contrast the counterfactual outcomes for two levels of a continuous exposure. To do this we must state the levels of exposure at which we seek comparisons. \n\nCrtitically, to ensure valid inference, we need to ensure that the potential outcomes are independent of the exposures received, namely: \n\n$$Y^a  \\perp\\!\\!\\!\\perp A|L$$\n\n**Or equivalently:**\n\n$$A \\perp\\!\\!\\!\\perp Y^a |L$$\n\nIf we have have only observational data, we cannot generally ensure that the exposures are independent of the counterfactual outcomes. For this reason, we use sensitivity analyis such at the calculating an *E-value* to assess the robustness of any result to unmeasured confounding [@vanderweele2017].\n\n## G-computation (or standardisation)\n\nTo consistently estimate a causal association from the statistical association evident in the data, we must infer the average outcomes for the entire population was it subject to different levels of the exposure variable $A = a, A=a*$. \n\n**If we  are interested in obtaining an average causal effect for the population.**\n\n$$ATE = E[Y^{a*}] - E[Y^a] = $$\n\n$$\\sum_l E[Y|A=a*, L=k=l]\\Pr[L=l] - \\sum_c E[Y|A=a, L=l]\\Pr[L=l]$$\n\nWe need not estimate $\\Pr(L = l)$. Rather we may obtain the weighted mean for the distribution of the counfounders in the data by taking the double expectation :[(Hernán, MA, Robins JM 2020, page 166)](https://paperpile.com/c/9vawcQ/uD7I/?locator=166).\n\n\\\n\n$$ATE = E[E(Y|A = a, \\boldsymbol{L}) - E(Y|A = a*, \\boldsymbol{L})]$$\n\nTo obtain marginal contrasts for the expected outcomes for the entire population solitary worship to different levels of  congregations size  used the stdReg package in R [(Sjölander 2016)](https://paperpile.com/c/9vawcQ/8bgN). \n\n## The steps for G-computation\n\n1.  First we fit a regression for each outcome on the exposure $A\\_{t0}$ and baseline covariates$\\boldsymbol{L} = (L_1, L_2,L_3 \\dots L_n)$. To avoid implausible assumptions of linearity we model the relationship between the exposure each of the potential outcomes of interest using a cubic spline.  We include in the set of baseline confounders $\\boldsymbol{L}$ the baseline measure of the exposure as well as the baseline response (or responses): $\\{A\\_{t-1}, \\boldsymbol{Y_{t-1}} = (Y_{1, t-1}, Y_{2, t-1}, Y_{3, t-1}\\dots Y_{n, t-1})\\} \\subset \\boldsymbol{L}$.  \n\nThis model give us $E(Y|A, \\boldsymbol{L})$\n\n2.  Second, we use the model in (1) to predict the values of a potential outcome $Y^{a}$ by setting the exposure to the value $A = a$.\n\nThis model gives us $\\hat{E}(Y|A = a, \\boldsymbol{L})$\n\n3.  Third, we use the model in (1) to predict the values of a different potential outcome $Y^{a*}$by setting the exposure to a different value of $A =a^{\\star}$.\n\nThis model gives us  $\\hat{E}(Y|A = a*,\\boldsymbol{L})$\n\n4.  Forth we obtain the focal contrast as the expected difference in the expected average outcomes when exposure at levels $a*$ and $a$. Where outcomes are continuous we calculate both mean of $Y^a$ and the mean of  $Y^{a*}$ and then obtain their difference.  This gives give us: \n\n$$\\hat{ATE} = \\hat{E}[\\hat{E}(Y|A = a, \\boldsymbol{L}) - \\hat{E}(Y|A = a*, \\boldsymbol{L})]$$\n\n5.  Where outcomes are binary, we calculate the causal risk ratio in moving between the different levels of A. Where binary outcomes are more common than 10% we use a log-normal model to calculate a causal rate ratio [@vanderweele2020]. \n\n6.  The stdReg package in R calculates standard errors using the Delta method from which we construct confidence intervals under asymptotic assumptions[@sjölander2016]. Additionally, we pool uncertainty arising from the multiple imputation procedure by employing Rubin's Rules. \n\n### Acknowledgements\n\"We are grateful to Arvid Sjölander for his help in modifying his stdReg package in R to enable G-computation with multiply-imputed datasets.\"\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}